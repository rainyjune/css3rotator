!function(factory){if("function"==typeof define&&(define.amd||define.cmd))define(function(require,exports,module){var $=require("zepto"),TouchObject=require("touch");return factory($,TouchObject)});else{var $="undefined"!=typeof Zepto?Zepto:jQuery,TouchObject=window.TouchObject;window.Css3Rotator=factory($,TouchObject)}}(function($,TouchObject){function Css3Rotator(element,options){function init(){prepareElements()&&addStyles()&&bindEvents()}function prepareElements(){if(slideContainer=element.find(mergedOptions.container),0===slideContainer.size())throw new Error('The container "'+mergedOptions.container+'" does not exist.');if(addSliderItems(),slides=slideContainer.children(),slideCount=slides.length,0===slideCount)throw new Error("There are no slides in the container.");return mergedOptions.loop&&(addDuplicatePages(),slidePageIndex=1),addIndicator(),!0}function addStyles(){element.addClass("rotatorRootElement"),setSlideRootHeight(),slideContainer.addClass("rotatorWrapper").addClass("flex-it"),slideDisplayCount=slideContainer.children().size();var slideContainerWidth=slideDisplayCount+"00%",slideContainerHeight=slideDisplayCount+"00%";return mergedOptions.slideWidth!==element.width()&&(slideContainerWidth=mergedOptions.slideWidth*slideDisplayCount),mergedOptions.slideHeight!==element.height()&&(slideContainerHeight=mergedOptions.slideHeight*slideDisplayCount),"horizontal"===mergedOptions.slideMode?slideContainer.addClass("flex-row").width(slideContainerWidth):slideContainer.addClass("flex-col").height(slideContainerHeight).width("100%"),slidePageWidth=slideContainer.children().eq(0).width(),slidePageHeight=slideContainer.children().eq(0).height(),mergedOptions.loop&&("horizontal"===mergedOptions.slideMode?(setTranslateXValue(-mergedOptions.slideWidth+"px"),currentTranslateXValue=-mergedOptions.slideWidth):(setTranslateYValue(-mergedOptions.slideHeight+"px"),currentTranslateYValue=-mergedOptions.slideHeight)),!0}function setAutoPlay(){mergedOptions.autoPlay&&(timer=setTimeout(autoPlay,mergedOptions.transitonInterval))}function addSliderItems(){var dataSource=mergedOptions.dataSource;if(dataSource&&$.isArray(dataSource)){var items=[];$.each(dataSource,function(index,item){items.push(getSliderItemString(item))}),slideContainer.append(items.join(""))}}function getSliderItemString(itemData){var itemDom=$("<div>").css("background-image","url("+itemData.img+")"),linkDom=$("<a>").attr({href:"javascript:void(0);","data-href":itemData.link}),titleDom=$("<h2>").text(itemData.title);return itemDom.append(linkDom.append(titleDom)).prop("outerHTML")}function addDuplicatePages(){var oldPages=slideContainer.children(),firstOldPage=oldPages.eq(0),lastOldPage=oldPages.eq(-1);slideContainer.prepend(lastOldPage.clone()),slideContainer.append(firstOldPage.clone())}function prev(){slidePage(!1)}function next(){slidePage(!0)}function slidePage(isNext){updateSlideIndex(isNext),slideToPage()}function slideToPage(){"horizontal"===mergedOptions.slideMode?setTranslateXValue():setTranslateYValue(),self.dispatchEvent("pageselected",[pageIndex+1])}function autoPlay(){if(mergedOptions.autoPlay){if(autoPlayFinished)return window.clearTimeout(timer),!1;if(slidePageIndex===slideDisplayCount-1){if(!mergedOptions.loop)return autoPlayFinished=!0,window.clearTimeout(timer),!1;disableTransitionDuration(),slidePageIndex=1,setTranslateXValue(),setTimeout(function(){enableTransitionDuration(),next()},0)}else 0===slidePageIndex?(disableTransitionDuration(),mergedOptions.loop&&(slidePageIndex=slideDisplayCount-2,setTranslateXValue()),setTimeout(function(){enableTransitionDuration(),next()},0)):next()}}function updateSlideIndex(isNext){isNext?(slidePageIndex++,pageIndex===slideCount-1?pageIndex=0:pageIndex++):(slidePageIndex--,0===pageIndex?pageIndex=slideCount-1:pageIndex--)}function setTranslateXValue(value){value||(value=slidePageWidth*slidePageIndex,currentTranslateXValue=-value,value=currentTranslateXValue+"px"),setSlideContainerTransform(value,0)}function setTranslateYValue(value){value||(value=slidePageHeight*slidePageIndex,currentTranslateYValue=-value,value=currentTranslateYValue+"px"),setSlideContainerTransform(0,value)}function setSlideContainerTransform(x,y){var translateValue=translateValuePrefix+x+", "+y+translateValuePostfix;slideContainer.css({"-webkit-transform":translateValue,"-moz-transform":translateValue,"-o-transform":translateValue,transform:translateValue})}function transitionEndEventHandler(){return updateIndicatorStatus(),setAutoPlay(),self.dispatchEvent("pagecompleted",[pageIndex+1]),!1}function bindEvents(){document.addEventListener("touchmove",preventDefault,!1),touchObj=new TouchObject(element[0]),$(window).on("resize",handleOrientationChange),slideContainer.on(transitionEndEventName,transitionEndEventHandler),$(element).on("tap",tapHandler),slideCount>=2&&($(element).on("swipe",enableTransitionDuration),$(element).on("swipeUp",swipeUpHandler),$(element).on("swipeDown",swipeDownHandler),$(element).on("swipeLeft",swipeLeftHandler),$(element).on("swipeRight",swipeRightHandler),$(element).on("swipeStart",swipeStartHandler),$(element).on("swipeCancel",swipeCancelMyHandler),$(element).on("swipeProgress",swipeProgressHandler)),setTimeout(function(){setTransitionDuration(),setAutoPlay()},0)}function preventDefault(e){e.preventDefault()}function swipeUpHandler(){"horizontal"===mergedOptions.slideMode?swipeCancelMyHandler():swipeNextHandler()}function swipeDownHandler(){"horizontal"===mergedOptions.slideMode?swipeCancelMyHandler():swipePreviousHandler()}function swipeLeftHandler(){"horizontal"===mergedOptions.slideMode?swipeNextHandler():swipeCancelMyHandler()}function swipeRightHandler(){"horizontal"===mergedOptions.slideMode?swipePreviousHandler():swipeCancelMyHandler()}function swipePreviousHandler(){mergedOptions.loop||0!==slidePageIndex?prev():swipeCancelMyHandler()}function swipeNextHandler(){mergedOptions.loop||slidePageIndex!==slideDisplayCount-1?next():swipeCancelMyHandler()}function tapHandler(e){return e.detail&&e.detail.target&&(window.location=$(e.detail.target).attr("data-href")),!1}function swipeStartHandler(e){if(window.clearTimeout(timer),"horizontal"===mergedOptions.slideMode){var nowTranslateXValue=getTranslateXValue(slideContainer[0]);currentTranslateXValue=nowTranslateXValue}else{var nowTranslateYValue=getTranslateYValue(slideContainer[0]);currentTranslateYValue=nowTranslateYValue}if(disableTransitionDuration(),"horizontal"===mergedOptions.slideMode?setTranslateXValue(nowTranslateXValue+"px"):setTranslateYValue(nowTranslateYValue+"px"),!mergedOptions.loop)return!1;if(slidePageIndex===slideDisplayCount-1)if(slidePageIndex=1,"horizontal"===mergedOptions.slideMode){var value=2*-mergedOptions.slideWidth+(slideContainer.width()+nowTranslateXValue);currentTranslateXValue=value,setTranslateXValue(value+"px")}else{var value=2*-mergedOptions.slideHeight+(slideContainer.height()+nowTranslateYValue);currentTranslateYValue=value,setTranslateYValue(value+"px")}else if(0===slidePageIndex)if(slidePageIndex=slideDisplayCount-2,"horizontal"===mergedOptions.slideMode){var value=-mergedOptions.slideWidth*slidePageIndex+nowTranslateXValue;currentTranslateXValue=value,setTranslateXValue(value+"px")}else{var value=-mergedOptions.slideHeight*slidePageIndex+nowTranslateYValue;currentTranslateYValue=value,setTranslateYValue(value+"px")}}function swipeProgressHandler(e){var movedX=e.detail.detail.movedPageX,movedY=e.detail.detail.movedPageY;"horizontal"===mergedOptions.slideMode?setTranslateXValue(currentTranslateXValue+movedX+"px"):setTranslateYValue(currentTranslateYValue+movedY+"px")}function swipeCancelMyHandler(){enableTransitionDuration(),"horizontal"===mergedOptions.slideMode?setTranslateXValue():setTranslateYValue()}function handleOrientationChange(){return window.clearTimeout(timer),disableTransitionDuration(),setTimeout(function(){element.css("height",""),setSlideRootHeight(),"horizontal"===mergedOptions.slideMode?(slidePageWidth=slideContainer.children().eq(0).width(),setTranslateXValue()):(slidePageHeight=slideContainer.children().eq(0).height(),setTranslateYValue()),updateIndicatorStatus(),setTimeout(function(){enableTransitionDuration(),setAutoPlay()},0)},500),!1}function setTransitionDuration(){slideContainer.css({"-webkit-transition-duration":mergedOptions.transitionDuration,"-moz-transition-duration":mergedOptions.transitionDuration,"-o-transition-duration":mergedOptions.transitionDuration,"transition-duration":mergedOptions.transitionDuration})}function disableTransitionDuration(){slideContainer.addClass("duration-initial")}function enableTransitionDuration(){slideContainer.removeClass("duration-initial")}function addIndicator(){for(var domStr="<strong class='"+mergedOptions.indicatorClass+"'>",i=0;slideCount>i;i++)domStr+="<span></span>";domStr+="</strong>",element.append(domStr),indicators=element.find("."+mergedOptions.indicatorClass).children(),indicators.eq(0).addClass(mergedOptions.indicatorActiveItemClass)}function updateIndicatorStatus(){indicators.removeClass(mergedOptions.indicatorActiveItemClass),indicators.eq(pageIndex).addClass(mergedOptions.indicatorActiveItemClass)}function getSlideRootHeight(aspectRatio){return"fullscreen"===aspectRatio?element.height()||window.innerHeight:element.width()/aspectRatio}function setSlideRootHeight(){element.height(getSlideRootHeight(mergedOptions.aspectRatio))}function getSlidePageIndexByPageIndex(pageIndex){return mergedOptions.loop?pageIndex+1:pageIndex}element="string"==typeof element?$(element):element;var self=this,defaults={container:".rotatorWrapper",transitionDuration:"5s",slideWidth:element.width(),slideHeight:element.height(),slideMode:"horizontal",aspectRatio:2,transitonInterval:"2000",pauseAfterTransition:!0,indicatorClass:"indicator",indicatorActiveItemClass:"current",loop:!1,autoPlay:!0},isTranslate3dSupported=has3d(),translateValuePrefix=isTranslate3dSupported?"translate3d(":"translate(";translateValuePostfix=isTranslate3dSupported?", 0)":")";var slidePageWidth,slidePageHeight,autoPlayFinished,touchObj,currentTranslateXValue=null,currentTranslateYValue=null,mergedOptions=$.extend(defaults,options),transitionEndEventName=getTransitionEndEventName(),slideCount=0,pageIndex=0,slideDisplayCount=0,slidePageIndex=0,slideContainer=null,slides=null,indicators=null,timer=null;init(),this.previous=function(){return 0===pageIndex?!1:(prev(),!0)},this.next=function(){return pageIndex===slideCount-1?!1:(next(),!0)},Object.defineProperty(this,"dispose",{value:function(){document.removeEventListener("touchmove",preventDefault,!1),$(window).off("resize",handleOrientationChange),slideContainer.off(transitionEndEventName,transitionEndEventHandler),$(element).off("tap",tapHandler),$(element).off("swipe",enableTransitionDuration),$(element).off("swipeUp",swipeUpHandler),$(element).off("swipeDown",swipeDownHandler),$(element).off("swipeLeft",swipeLeftHandler),$(element).off("swipeRight",swipeRightHandler),$(element).off("swipeStart",swipeStartHandler),$(element).off("swipeCancel",swipeCancelMyHandler),$(element).off("swipeProgress",swipeProgressHandler),touchObj.dispose()}}),Object.defineProperty(this,"element",{value:element}),Object.defineProperty(this,"currentPage",{get:function(){return pageIndex+1},set:function(value){0>=value||value>slideCount||(pageIndex=value-1,slidePageIndex=getSlidePageIndexByPageIndex(pageIndex),slideToPage())}}),this.count=function(){return slideCount}}function getTransitionEndEventName(){var i,undefined,el=document.createElement("div"),transitions={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend"};for(i in transitions)if(transitions.hasOwnProperty(i)&&el.style[i]!==undefined)return transitions[i];return""}function has3d(){var has3d,el=document.createElement("p"),transforms={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(el,null);for(var t in transforms)void 0!==el.style[t]&&(el.style[t]="translate3d(1px,1px,1px)",has3d=window.getComputedStyle(el).getPropertyValue(transforms[t]));return document.body.removeChild(el),void 0!==has3d&&has3d.length>0&&"none"!==has3d}function getTranslateXValue(domElement){var val=getTranslateValue(domElement);return val.m41}function getTranslateYValue(domElement){var val=getTranslateValue(domElement);return val.m42}function getTranslateValue(domElement){var cssMatrixObject=null;"undefined"!=typeof WebKitCSSMatrix?cssMatrixObject=WebKitCSSMatrix:"undefined"!=typeof MSCSSMatrix?cssMatrixObject=MSCSSMatrix:"undefined"!=typeof DOMMatrix&&(cssMatrixObject=DOMMatrix);var style=window.getComputedStyle(domElement),matrixString="";return"undefined"!=typeof style.webkitTransform?matrixString=style.webkitTransform:"undefined"!=typeof style.mozTransform?matrixString=style.mozTransform:"undefined"!=typeof style.msTransform?matrixString=style.msTransform:"undefined"!=typeof style.transform&&(matrixString=style.transform),new cssMatrixObject(matrixString)}return Css3Rotator.prototype.addEventListener=function(type,listener){this.element.on(type,listener)},Css3Rotator.prototype.removeEventListener=function(type,listener){this.element.off(type,listener)},Css3Rotator.prototype.dispatchEvent=function(type,details){this.element.trigger(type,details)},$.fn.css3Rotator=function(options){return this.each(function(index,item){new Css3Rotator($(item),options)})},Css3Rotator});